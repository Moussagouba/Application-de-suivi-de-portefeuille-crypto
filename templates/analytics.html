{% extends "base.html" %}

{% block title %}Analytics - Portefeuille Crypto{% endblock %}

{% block content %}
<div class="fade-in">
    <h1 class="mb-6 text-center">
        <i class="fas fa-chart-line"></i>
        Analytics du Portefeuille
    </h1>

    {% if not has_data %}
    <div class="empty-state">
        <i class="fas fa-chart-line"></i>
        <p>Aucune donnée disponible pour l'analyse</p>
        <a href="{{ url_for('add_crypto') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Ajouter des cryptomonnaies
        </a>
    </div>
    {% else %}

    <!-- Résumé des performances -->
    <div class="grid grid-cols-1 grid-cols-4 mb-6">
        <div class="card text-center">
            <div class="card-body">
                <div class="text-secondary mb-1">Valeur Totale</div>
                <div class="text-2xl font-bold text-primary">${{ "%.2f"|format(total_portfolio_value) }}</div>
            </div>
        </div>
        <div class="card text-center">
            <div class="card-body">
                <div class="text-secondary mb-1">Investi</div>
                <div class="text-2xl font-bold">${{ "%.2f"|format(total_invested) }}</div>
            </div>
        </div>
        <div class="card text-center">
            <div class="card-body">
                <div class="text-secondary mb-1">Gain/Perte</div>
                <div class="text-2xl font-bold {{ 'profit' if total_profit_loss >= 0 else 'loss' }}">
                    {{ '$%.2f'|format(total_profit_loss) }}
                </div>
            </div>
        </div>
        <div class="card text-center">
            <div class="card-body">
                <div class="text-secondary mb-1">Performance</div>
                <div class="text-2xl font-bold {{ 'profit' if total_profit_loss >= 0 else 'loss' }}">
                    {{ '%.1f'|format((total_profit_loss/total_invested*100) if total_invested > 0 else 0) }}%
                </div>
            </div>
        </div>
    </div>

    <!-- Détails des performances -->
    <div class="grid grid-cols-1 grid-cols-2 mb-6">
        <!-- Meilleure performance -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-arrow-up text-success"></i>
                    Meilleure Performance
                </h3>
            </div>
            <div class="card-body">
                {% if best_performer %}
                <div class="crypto-card">
                    <div class="crypto-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">{{ best_performer.name }}</div>
                        <div class="crypto-symbol">{{ best_performer.symbol }}</div>
                        <div class="text-sm text-secondary">
                            {{ "%.2f"|format(best_performance) }}% de gain
                        </div>
                    </div>
                    <div class="crypto-value text-right">
                        <div class="current-price">${{ "%.2f"|format(best_performer.current_price) }}</div>
                        <div class="text-sm text-success">
                            +${{ "%.2f"|format(best_performer.profit_loss) }}
                        </div>
                    </div>
                </div>
                {% else %}
                <p class="text-center text-secondary">Aucune performance à afficher</p>
                {% endif %}
            </div>
        </div>

        <!-- Moins bonne performance -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-arrow-down text-danger"></i>
                    Moins Bonne Performance
                </h3>
            </div>
            <div class="card-body">
                {% if worst_performer %}
                <div class="crypto-card">
                    <div class="crypto-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="crypto-info">
                        <div class="crypto-name">{{ worst_performer.name }}</div>
                        <div class="crypto-symbol">{{ worst_performer.symbol }}</div>
                        <div class="text-sm text-secondary">
                            {{ "%.2f"|format(worst_performance) }}% de perte
                        </div>
                    </div>
                    <div class="crypto-value text-right">
                        <div class="current-price">${{ "%.2f"|format(worst_performer.current_price) }}</div>
                        <div class="text-sm text-danger">
                            ${{ "%.2f"|format(worst_performer.profit_loss) }}
                        </div>
                    </div>
                </div>
                {% else %}
                <p class="text-center text-secondary">Aucune performance à afficher</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tableau détaillé -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-table"></i>
                Détail par Cryptomonnaie
            </h3>
        </div>
        <div class="card-body">
            <div class="table-container">
                <table class="performance-table">
                    <thead>
                        <tr>
                            <th>Crypto</th>
                            <th>Quantité</th>
                            <th>Prix d'Achat</th>
                            <th>Prix Actuel</th>
                            <th>Valeur</th>
                            <th>Gain/Perte</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for crypto in cryptos %}
                        <tr>
                            <td>
                                <div class="crypto-name-cell">
                                    <div class="crypto-icon-sm">
                                        <i class="fas fa-coins"></i>
                                    </div>
                                    <div>
                                        <div class="font-semibold">{{ crypto.name }}</div>
                                        <div class="text-sm text-secondary">{{ crypto.symbol }}</div>
                                    </div>
                                </div>
                            </td>
                            <td>{{ "%.8f"|format(crypto.quantity) }}</td>
                            <td>${{ "%.2f"|format(crypto.purchase_price) }}</td>
                            <td>${{ "%.2f"|format(crypto.current_price) }}</td>
                            <td class="font-semibold">${{ "%.2f"|format(crypto.current_value) }}</td>
                            <td class="{{ 'text-success' if crypto.profit_loss >= 0 else 'text-danger' }}">
                                {{ '$%.2f'|format(crypto.profit_loss) }}
                            </td>
                            <td class="{{ 'text-success' if crypto.profit_loss >= 0 else 'text-danger' }}">
                                {{ '%.2f'|format(crypto.profit_loss_percentage) }}%
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Message informatif sur les graphiques -->
    <div class="card mt-6">
        <div class="card-body text-center">
            <i class="fas fa-chart-pie" style="font-size: 3rem; color: var(--text-light); margin-bottom: 1rem;"></i>
            <p class="text-secondary">Les graphiques sont disponibles sur la page d'accueil</p>
            <a href="{{ url_for('index') }}" class="btn btn-primary">
                <i class="fas fa-home"></i>
                Retour à l'accueil
            </a>
        </div>
        /* Centrage des cartes et grilles */
        .grid-cols-1.grid-cols-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin-bottom: 1.5rem;
        }

        .grid-cols-1.grid-cols-4 {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
        }

        /* Centrage du contenu dans les cartes */
        .card-body {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        width: 100%;
        }

        /* Centrage spécifique pour les statistiques */
        .card.text-center {
        text-align: center;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
        .grid-cols-4 {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        }

        .grid-cols-1.grid-cols-2 {
        grid-template-columns: 1fr;
        gap: 1rem;
        }

        .performance-table {
        font-size: 0.8rem;
        }

        .performance-table th,
        .performance-table td {
        padding: 0.5rem;
        }
        }

        @media (max-width: 480px) {
        .grid-cols-4 {
        grid-template-columns: 1fr;
        }
        }
    </div>

    {% endif %}
</div>

<style>
    .table-container {
        overflow: hidden;
    }

    .performance-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
    }

    .performance-table th,
    .performance-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
    }

    .performance-table th {
        background: var(--bg-secondary);
        font-weight: 600;
        color: var(--text-primary);
    }

    .performance-table tr:hover {
        background: var(--bg-secondary);
    }

    .crypto-name-cell {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .crypto-icon-sm {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.8rem;
    }

    .text-success {
        color: var(--accent-color);
    }

    .text-danger {
        color: var(--danger-color);
    }

    .text-primary {
        color: var(--primary-color);
    }

    .text-2xl {
        font-size: 1.5rem;
        line-height: 2rem;
    }

    @media (max-width: 768px) {
        .grid-cols-4 {
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .performance-table {
            font-size: 0.8rem;
        }

        .performance-table th,
        .performance-table td {
            padding: 0.5rem;
        }
    }
</style>

{% endblock %}